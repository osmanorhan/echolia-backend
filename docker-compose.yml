version: '3.8'

services:
  api:
    build: .
    ports:
      - "8000:8000"
    environment:
      # Turso Configuration
      - TURSO_ORG_URL=${TURSO_ORG_URL}
      - TURSO_AUTH_TOKEN=${TURSO_AUTH_TOKEN}
      - EMBEDDED_REPLICA=true
      - SYNC_INTERVAL=60

      # Auth Configuration
      - JWT_SECRET=${JWT_SECRET}
      - JWT_ALGORITHM=HS256
      - ACCESS_TOKEN_EXPIRE_MINUTES=60
      - REFRESH_TOKEN_EXPIRE_DAYS=30

      # LLM Provider API Keys (Optional)
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}

      # App Configuration
      - ENVIRONMENT=development
      - DEBUG=true
      - LOG_LEVEL=info
      - DATA_DIR=/app/data

    volumes:
      - ./app:/app/app
      - ./data:/app/data
    command: uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

  caddy:
    image: caddy:2-alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data
      - caddy_config:/config
    depends_on:
      - api

volumes:
  caddy_data:
  caddy_config:
